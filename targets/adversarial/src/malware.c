////////////////////////////////////////////////////////////////////////////////
//
//  File          : src/malware.c
//  Description   : This is the simple malware code that will be used in the
//                  target samples.
//
//   Author : Thomason Zhao
//

#include "malware.h"

#include <unistd.h>

//
// Global variables

char key = 0x77;
// XOR key for shellcode

char shell[] = {0x58, 0x15, 0x1e, 0x19, 0x58, 0x4, 0x1f, 0x00};
// Shell string for /bin/sh after xor decryption with key 0x77

////////////////////////////////////////////////////////////////////////////////
//
// Function     : xor_enc
// Description  : Encrypts a buffer with a key using XOR
//
// Inputs       : buf - buffer to encrypt
//                key - key to encrypt with
// Outputs      : None

void xor_enc(char *buf, char key) {
    int i;
    for (i = 0; buf[i] != '\0'; i++) {
        buf[i] ^= key;
    }
}

////////////////////////////////////////////////////////////////////////////////
//
// Function     : shellcode
// Description  : Executes a shell to simulate malware
//
// Inputs       : None
// Outputs      : None

void shellcode(void) {
    char *args[] = {shell, NULL};
    xor_enc(shell, key);
    execve(shell, args, NULL);
}